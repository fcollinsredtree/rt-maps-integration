"use strict";(globalThis.webpackChunkredtree_maps_integration=globalThis.webpackChunkredtree_maps_integration||[]).push([[2821],{2821:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var s=i(71566),r=i(90071),a=i(36581),n=i(116),h=i(61660),l=i(18015),o=i(85464),u=(i(82555),i(16431),i(37755)),d=i(32271),c=i(30957),g=i(24085),p=i(49513),_=i(92038),f=i(21301);let m=class extends((0,c.e)(f.A)){constructor(){super(...arguments),this._highlightCounter=new _.t}attach(){this.graphicsView=new p.A({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:this.layer.graphics,container:new g.A(this.view.featuresTilingScheme),layerId:this.layer.id}),this.container.addChild(this.graphicsView.container),this.addAttachHandles([this.layer.on("graphic-update",this.graphicsView.graphicUpdateHandler),this.watch("layer.visible",(e=>{e&&(this.graphicsView.update({state:this.view.state}),this.graphicsView.pushUpdate())}))]),this._updateHighlight()}detach(){this.container.removeAllChildren(),this.graphicsView=(0,l.pR)(this.graphicsView)}async hitTest(e){return this.graphicsView?this.graphicsView.hitTest(e).map((t=>({type:"graphic",graphic:t,mapPoint:e,layer:this.layer}))):null}queryGraphics(){return Promise.resolve(this.graphicsView.graphics)}update(e){this.graphicsView.processUpdate(e)}viewChange(){this.graphicsView.viewChange()}moveEnd(){}isUpdating(){return!this.graphicsView||this.graphicsView.updating}highlight(e,t="highlight"){let i;"number"==typeof e?i=[e]:e instanceof r.A?i=[e.uid]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):n.A.isCollection(e)&&e.length>0&&(i=e.map((e=>e&&e.uid)).toArray());const s=i?.filter(a.Ru);return s?.length?(this._addHighlight(s,t),(0,h.hA)((()=>this._removeHighlight(s,t)))):(0,h.hA)()}_addHighlight(e,t){this._highlightCounter.addReason(e,t),this._updateHighlight()}_removeHighlight(e,t){this._highlightCounter.deleteReason(e,t),this._updateHighlight()}_updateHighlight(){const e=[];for(const t of this._highlightCounter.ids()){const i=this._highlightCounter.getHighlightReason(t),s=(0,d.$r)(i);e.push({objectId:t,highlightFlags:s})}this.graphicsView?.setHighlight(e)}};(0,s._)([(0,o.MZ)()],m.prototype,"graphicsView",void 0),m=(0,s._)([(0,u.$)("esri.views.2d.layers.GraphicsLayerView2D")],m);const v=m},73950:(e,t,i)=>{i.d(t,{f:()=>V});var s=i(18015),r=i(38896),a=i(93540),n=i(96749),h=i(12701),l=i(4359);let o=0;function u(e,t){return new n.c((0,l.U)(o++),e,t)}const d={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class c{constructor(){this.instances={fill:u(h.YS.fill,{uniforms:d,optionalAttributes:{zoomRange:!0}}),marker:u(h.YS.marker,{uniforms:d,optionalAttributes:{zoomRange:!0}}),line:u(h.YS.line,{uniforms:d,optionalAttributes:{zoomRange:!0}}),text:u(h.YS.text,{uniforms:d,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:u(h.YS.complexFill,{uniforms:d,optionalAttributes:{zoomRange:!0}}),texturedLine:u(h.YS.texturedLine,{uniforms:d,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((e,t)=>(e.set(t.instanceId,t),e)),new Map)}getInstance(e){return this._instancesById.get(e)}}var g=i(63051),p=i(93924),_=i(1065),f=i(55452),m=i(37519),v=i(2005),b=i(45543),w=i(70411),y=i(85262),A=i(81652);const S=Math.PI/180;class R extends v.q{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,p.vt)(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,s.WD)(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(y.dn.ONE,y.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);const s=this._program;t.bindVAO(this._vao),t.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(y.WR.LINES,8*i.length,y.pe.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,p.vt)()}}_createShaderProgram(e){this._program||(this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",x().attributes))}_updateMatricesAndLocalOrigin(e){const{state:t}=e,{displayMat3:i,size:s,resolution:r,pixelRatio:a,rotation:n,viewpoint:h}=t,l=S*n,{x:o,y:u}=h.targetGeometry,d=(0,m.mT)(o,t.spatialReference);this._localOrigin.x=d,this._localOrigin.y=u;const c=a*s[0],p=a*s[1],v=r*c,b=r*p,w=(0,g.D_)(this._dvsMat3);(0,g.lw)(w,w,i),(0,g.Tl)(w,w,(0,_.fA)(c/2,p/2)),(0,g.hs)(w,w,(0,f.fA)(s[0]/v,-p/b,1)),(0,g.e$)(w,w,-l)}_updateBufferData(e,t){const{x:i,y:s}=this._localOrigin,r=8*t.length,a=new Float32Array(r),n=new Uint32Array(8*t.length);let h=0,l=0;for(const e of t)e&&(a[2*h]=e[0]-i,a[2*h+1]=e[1]-s,a[2*h+2]=e[0]-i,a[2*h+3]=e[3]-s,a[2*h+4]=e[2]-i,a[2*h+5]=e[3]-s,a[2*h+6]=e[2]-i,a[2*h+7]=e[1]-s,n[l]=h+0,n[l+1]=h+3,n[l+2]=h+3,n[l+3]=h+2,n[l+4]=h+2,n[l+5]=h+1,n[l+6]=h+1,n[l+7]=h+0,h+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(a.buffer):this._vertexBuffer=w.g.createVertex(e,y._U.DYNAMIC_DRAW,a.buffer),this._indexBuffer?this._indexBuffer.setData(n):this._indexBuffer=w.g.createIndex(e,y._U.DYNAMIC_DRAW,n),!this._vao){const t=x();this._vao=new A.Z(e,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const x=()=>(0,b.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:y.pe.FLOAT}]});class V extends r.j{constructor(e){super(e),this._instanceStore=new c,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,s.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new R(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(const t of this.children){if(!t.visible)continue;const i=t.getDisplayList(this._instanceStore,a.ch.STRICT_ORDER);i?.render(e)}}}},24085:(e,t,i)=>{i.d(t,{A:()=>n});var s=i(93540),r=i(73950),a=i(52080);class n extends r.f{renderChildren(e){for(const t of this.children)t.setTransform(e.state);if(super.renderChildren(e),this.attributeView.update(),this.children.some((e=>e.hasData))){switch(e.drawPhase){case s.S5.MAP:this._renderChildren(e,s.RI.All);break;case s.S5.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}_renderHighlight(e){(0,a.lB)(e,!1,(e=>{this._renderChildren(e,s.RI.Highlight)}))}}}}]);