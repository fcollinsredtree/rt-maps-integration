"use strict";(globalThis.webpackChunkredtree_maps_integration=globalThis.webpackChunkredtree_maps_integration||[]).push([[5987],{55987:(e,t,s)=>{s.d(t,{addOrUpdateResources:()=>c,bg:()=>d,cL:()=>p,fetchResources:()=>n,removeAllResources:()=>i,removeResource:()=>l});var r=s(18798),o=s(41509),a=s(76097);async function n(e,t={},s){await e.load(s);const r=(0,a.fj)(e.itemUrl,"resources"),{start:o=1,num:n=10,sortOrder:c="asc",sortField:l="resource"}=t,i={query:{start:o,num:n,sortOrder:c,sortField:l,token:e.apiKey},signal:s?.signal},u=await e.portal.request(r,i);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:s,resource:r})=>({created:new Date(t),size:s,resource:e.resourceFromPath(r)})))}}async function c(e,t,s,r){const n=new Map;for(const{resource:e,content:r,compress:a,access:c}of t){if(!e.hasPath())throw new o.A(`portal-item-resource-${s}:invalid-path`,"Resource does not have a valid path");const[t,l]=u(e.path),i=`${t}/${a??""}/${c??""}`;n.has(i)||n.set(i,{prefix:t,compress:a,access:c,files:[]}),n.get(i).files.push({fileName:l,content:r})}await e.load(r);const c=(0,a.fj)(e.userItemUrl,"add"===s?"addResources":"updateResources");for(const{prefix:t,compress:s,access:o,files:a}of n.values()){const n=25;for(let l=0;l<a.length;l+=n){const i=a.slice(l,l+n),u=new FormData;t&&"."!==t&&u.append("resourcesPrefix",t),s&&u.append("compress","true"),o&&u.append("access",o);let p=0;for(const{fileName:e,content:t}of i)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(c,{method:"post",body:u,signal:r?.signal})}}}async function l(e,t,s){if(!t.hasPath())throw new o.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const r=(0,a.fj)(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:s?.signal}),t.portalItem=null}async function i(e,t){await e.load(t);const s=(0,a.fj)(e.userItemUrl,"removeResources");return e.portal.request(s,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function u(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}async function p(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,r.A)(e.url,{responseType:"blob"})).data}function d(e,t){if(!e.hasPath())return null;const[s,,r]=function(e){const[t,s]=function(e){const t=(0,a.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[r,o]=u(t);return[r,o,s]}(e.path);return e.portalItem.resourceFromPath((0,a.fj)(s,t+r))}}}]);