"use strict";(globalThis.webpackChunkredtree_maps_integration=globalThis.webpackChunkredtree_maps_integration||[]).push([[3753],{10767:(e,t,n)=>{function r(e){return null!=l(e)||null!=i(e)}function o(e){return a.test(e)}function s(e){return l(e)??i(e)}function i(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let n=!0;if(c&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,r=0;for(;!t&&r<=e.length;)t=!u.test(e[r]),r++;n=!t}}return n}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function l(e){const t=a.exec(e);if(!t?.groups)return null;const n=t.groups,r=+n.year,o=+n.month-1,s=+n.day,i=+(n.hours??"0"),l=+(n.minutes??"0"),u=+(n.seconds??"0");if(i>23)return null;if(l>59)return null;if(u>59)return null;const c=n.ms??"0",d=c?+c.padEnd(3,"0").substring(0,3):0;let p;if(n.isUTC||!n.offsetSign)p=Date.UTC(r,o,s,i,l,u,d);else{const e=+n.offsetHours,t=+n.offsetMinutes;p=6e4*("+"===n.offsetSign?-1:1)*(60*e+t)+Date.UTC(r,o,s,i,l,u,d)}return Number.isNaN(p)?null:p}n.d(t,{Br:()=>o,Cq:()=>r,_U:()=>s});const a=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,u=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,c=!Number.isNaN(new Date("technology 10").getTime())},33753:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var r=n(71566),o=(n(29747),n(14717)),s=(n(5971),n(68797),n(98172),n(86788),n(55831),n(76673),n(55983),n(2885),n(97779),n(68261)),i=n(87216),l=n(85464),a=(n(82555),n(16431),n(1724),n(37755)),u=n(77069),c=n(88999),d=n(41509),p=n(97487),f=n(4150),h=n(73758),y=n(40546),m=n(62771);let g=class extends p.A{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getSource(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:n,supportedCrs:r},layer:{apiKey:o,customParameters:s,effectiveMaxRecordCount:i}}=this;return{type:"ogc-source",collection:e,layerDefinition:t,maxRecordCount:i,queryParameters:{apiKey:o,customParameters:s},spatialReference:n,supportedCrs:r}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then((e=>y.A.fromJSON(e)))}queryFeaturesJSON(e,t={}){const n=this.getSource();return this.load(t).then((()=>(0,h.bW)(n,e,t)))}queryObjectIds(e,t={}){return null}serviceSupportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator&&!this.featureDefinition.supportedCrs[e.wkid])}_conformsToType(e,t){const n=new RegExp(`^${(0,f.Cj)(t)}$`,"i");return e.conformsTo.some((e=>n.test(e)))??!1}_getCapabilities(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:t,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}_getMaxRecordCount(e){const t=e?.components?.parameters;return t?.limit?.schema?.maximum??t?.limitFeatures?.schema?.maximum}_getStorageSpatialReference(e){const t=e.storageCrs??h.QE,n=(0,h.J0)(t);return null==n?m.A.WGS84:new m.A({wkid:n})}_getSupportedSpatialReferences(e,t){const n="#/crs",r=e.crs??[h.QE],o=r.includes(n)?r.filter((e=>e!==n)).concat(t.crs??[]):r,s=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return o.filter((e=>!s.test(e)))}async _loadOGCServices(e,t){const n=null!=t?t.signal:null,{apiKey:r,collectionId:o,customParameters:s,fields:i,geometryType:l,hasZ:a,objectIdField:c,timeInfo:p,url:y}=e,m={fields:i?.map((e=>e.toJSON())),geometryType:u.Y.toJSON(l),hasZ:a??!1,objectIdField:c,timeInfo:p?.toJSON()},g={apiKey:r,customParameters:s,signal:n},w=await(0,h.Ki)(y,g),[b,I]=await Promise.all([(0,h.Px)(w,g),(0,h.bV)(w,g)]);if(!this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new d.A("ogc-feature-layer:no-geojson-support","Server does not support geojson");const F=I.collections.find((({id:e})=>e===o));if(!F)throw new d.A("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const v=this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await(0,h.GA)(w,g):null,T=await(0,h.GL)(F,m,g),M=this._getMaxRecordCount(v),S=this._getCapabilities(T.hasZ,M),j=this._getStorageSpatialReference(F).toJSON(),A=this._getSupportedSpatialReferences(F,I),x=new RegExp(`^${(0,f.Cj)(h.vJ)}`,"i"),P={};for(const e of A){const t=(0,h.J0)(e);null!=t&&(P[t]||(P[t]=e.replace(x,"")))}this.featureDefinition={capabilities:S,collection:F,layerDefinition:T,spatialReference:j,supportedCrs:P}}};(0,r._)([(0,l.MZ)()],g.prototype,"featureDefinition",void 0),(0,r._)([(0,l.MZ)({constructOnly:!0})],g.prototype,"layer",void 0),(0,r._)([(0,l.MZ)()],g.prototype,"type",void 0),g=(0,r._)([(0,a.$)("esri.layers.graphics.sources.OGCFeatureSource")],g);var w=n(18621),b=n(18453),I=n(18469),F=n(36521),v=n(52481),T=n(70162),M=n(46403),S=n(36414),j=n(22019),A=n(98265),x=n(80358),P=n(38420),Z=n(45340),N=n(30086),O=n(7683),_=n(44857),C=n(65922),G=n(8238),R=n(9993),k=n(99544),D=n(93710);const q=(0,O.p)();let E=class extends((0,w.p)((0,I.d)((0,v.J)((0,F.F)((0,b.dM)((0,M.f)((0,x.e)((0,A.j)((0,T.q)((0,S.A)((0,j.J)((0,i.P)(c.A))))))))))))){constructor(e){super(e),this.capabilities=null,this.collectionId=null,this.copyright=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.maxRecordCount=null,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new g({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then((()=>this._fetchService(e)))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}get effectiveMaxRecordCount(){return this.maxRecordCount??this.capabilities?.query.maxRecordCount??5e3}get isTable(){return this.loaded&&null==this.geometryType}set renderer(e){(0,_.yp)(e,this.fieldsIndex),this._set("renderer",e)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,k.tn)(this,e)}createQuery(){return new R.A}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n,r=!1;const o=t?.feature?.attributes,s=this.typeIdField&&o?.[this.typeIdField];return null!=s&&this.types&&(r=this.types.some((t=>t.id==s&&(n=t.domains?.[e],"inherited"===n?.type&&(n=this._getLayerDomain(e)),!0)))),r||n||(n=this._getLayerDomain(e)),n}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(R.A.from(e)||this.createQuery(),t))).then((e=>(e?.features?.forEach((e=>{e.layer=e.sourceLayer=this})),e)))}serviceSupportsSpatialReference(e){return this.source?.serviceSupportsSpatialReference(e)??!1}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),(0,_.yp)(this.renderer,this.fieldsIndex),(0,_.sv)(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};(0,r._)([(0,l.MZ)({readOnly:!0,json:{origins:{service:{read:!0}}}})],E.prototype,"capabilities",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:!0}})],E.prototype,"collectionId",void 0),(0,r._)([(0,l.MZ)({type:String})],E.prototype,"copyright",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],E.prototype,"defaultPopupTemplate",null),(0,r._)([(0,l.MZ)({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],E.prototype,"description",void 0),(0,r._)([(0,l.MZ)({type:String})],E.prototype,"displayField",void 0),(0,r._)([(0,l.MZ)({type:Number})],E.prototype,"effectiveMaxRecordCount",null),(0,r._)([(0,l.MZ)(P.Yj)],E.prototype,"elevationInfo",void 0),(0,r._)([(0,l.MZ)({type:[N.A],json:{origins:{service:{name:"layerDefinition.fields"}}}})],E.prototype,"fields",void 0),(0,r._)([(0,l.MZ)(q.fieldsIndex)],E.prototype,"fieldsIndex",void 0),(0,r._)([(0,l.MZ)({readOnly:!0,type:D.A,json:{origins:{service:{name:"layerDefinition.extent"}}}})],E.prototype,"fullExtent",void 0),(0,r._)([(0,l.MZ)({type:u.g.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:u.g.read}}}}})],E.prototype,"geometryType",void 0),(0,r._)([(0,l.MZ)({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],E.prototype,"hasZ",void 0),(0,r._)([(0,l.MZ)({type:Boolean,readOnly:!0})],E.prototype,"isTable",null),(0,r._)([(0,l.MZ)({type:[C.A],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:G.w},write:!0}}}})],E.prototype,"labelingInfo",void 0),(0,r._)([(0,l.MZ)(P.kF)],E.prototype,"labelsVisible",void 0),(0,r._)([(0,l.MZ)(P.fV)],E.prototype,"legendEnabled",void 0),(0,r._)([(0,l.MZ)({type:Number})],E.prototype,"maxRecordCount",void 0),(0,r._)([(0,l.MZ)({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],E.prototype,"objectIdField",void 0),(0,r._)([(0,l.MZ)({type:["OGCFeatureLayer"]})],E.prototype,"operationalLayerType",void 0),(0,r._)([(0,l.MZ)(P.M6)],E.prototype,"popupEnabled",void 0),(0,r._)([(0,l.MZ)({type:o.A,json:{name:"popupInfo",write:!0}})],E.prototype,"popupTemplate",void 0),(0,r._)([(0,l.MZ)({types:s.H,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:s.X,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],E.prototype,"renderer",null),(0,r._)([(0,l.MZ)(P.PY)],E.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],E.prototype,"source",void 0),(0,r._)([(0,l.MZ)({readOnly:!0,type:m.A,json:{origins:{service:{read:!0}}}})],E.prototype,"spatialReference",void 0),(0,r._)([(0,l.MZ)({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],E.prototype,"title",void 0),(0,r._)([(0,l.MZ)({readOnly:!0,json:{read:!1}})],E.prototype,"type",void 0),(0,r._)([(0,l.MZ)({type:String,readOnly:!0})],E.prototype,"typeIdField",void 0),(0,r._)([(0,l.MZ)({type:[Z.A]})],E.prototype,"types",void 0),(0,r._)([(0,l.MZ)(P.OZ)],E.prototype,"url",void 0),E=(0,r._)([(0,a.$)("esri.layers.OGCFeatureLayer")],E);const L=E},29241:(e,t,n)=>{n.d(t,{N3:()=>s,Om:()=>o});var r=n(36511);class o{constructor(e=null,t={},n,r){this.geometry=e,this.attributes=t,this.centroid=n,this.objectId=r,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const n=e.geometry?r.A.fromJSON(e.geometry):null,s=e.centroid?r.A.fromJSON(e.centroid):null,i=e.attributes[t];return new o(n,e.attributes,s,i)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},19129:(e,t,n)=>{n.d(t,{A:()=>r});class r{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},36511:(e,t,n)=>{n.d(t,{A:()=>r});class r{constructor(e=[],t=[],n=!1){this.lengths=e??[],this.coords=t??[],this.hasIndeterminateRingOrder=n}static fromJSON(e){return new r(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[t,n,o,s]=e,i=o-t,l=s-n;return new r([5],[t,n,i,0,0,l,-i,0,0,-l])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let n=0;n<this.lengths.length;n++){const r=this.lengths[n];for(let n=0;n<r;n++)e(this.coords[2*(n+t)],this.coords[2*(n+t)+1]);t+=r}}deltaDecode(){const e=this.clone(),{coords:t,lengths:n}=e;let r=0;for(const e of n){for(let n=1;n<e;n++)t[2*(r+n)]+=t[2*(r+n)-2],t[2*(r+n)+1]+=t[2*(r+n)-1];r+=e}return e}clone(e){if(0===this.lengths.length)return new r([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),n=this.coords.slice(0,t);return e?(e.set(n),new r(this.lengths,e,this.hasIndeterminateRingOrder)):new r(Array.from(this.lengths),Array.from(n),this.hasIndeterminateRingOrder)}}},96015:(e,t,n)=>{n.d(t,{B2:()=>F,BW:()=>R,Ch:()=>oe,DF:()=>T,Di:()=>z,E2:()=>J,IE:()=>I,Nl:()=>X,Q4:()=>se,Rk:()=>le,Ux:()=>U,Ye:()=>q,ZF:()=>K,eU:()=>E,eY:()=>V,jH:()=>H,jQ:()=>re,kz:()=>ee,oN:()=>B,q3:()=>Y,qK:()=>C,qN:()=>_,z5:()=>D,zv:()=>W});var r=n(41509),o=n(16431),s=n(18015),i=n(21215),l=n(59130),a=n(32191),u=n(29241),c=n(19129),d=n(36511);function p(e,t){return e?t?4:3:t?3:2}const f=()=>o.A.getLogger("esri.layers.graphics.featureConversionUtils"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},y=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s},m=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+2]},g=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+3]},w=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+2],e[n+3]=t[r+3]};function b(e,t,n,r){if(e){if(n)return t&&r?w:m;if(t&&r)return g}else if(t&&r)return m;return y}function I({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function F({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function v({scale:e,translate:t},n,r){return n*e[r]+t[r]}function T(e,t,n){return e?t?n?Z(e):j(e):n?x(e):M(e):null}function M(e){const t=e.coords;return{x:t[0],y:t[1]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function j(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function x(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function Z(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function N(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t){return e&&t?N:e?A:t?P:S}function _(e,t,n=O(null!=t.z,null!=t.m)){return n(e,t)}function C(e,t,n){if(null==e)return null;const r=p(t,n),o=[];for(let t=0;t<e.coords.length;t+=r){const n=[];for(let o=0;o<r;o++)n.push(e.coords[t+o]);o.push(n)}return t?n?{points:o,hasZ:t,hasM:n}:{points:o,hasZ:t}:n?{points:o,hasM:n}:{points:o}}function G(e,t,n=p(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let o=0;for(const e of t.points)for(let t=0;t<n;t++)r[o++]=e[t];return e}function R(e,t,n){if(!e)return null;const r=p(t,n),{coords:o,lengths:s}=e,i=[];let l=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(o[l++]);t.push(e)}i.push(t)}return t?n?{paths:i,hasZ:t,hasM:n}:{paths:i,hasZ:t}:n?{paths:i,hasM:n}:{paths:i}}function k(e,t,n=p(t.hasZ,t.hasM)){const{lengths:r,coords:o}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<n;e++)o[s++]=t[e];r.push(e.length)}return e}function D(e,t,n){if(!e)return null;const r=p(t,n),{coords:o,lengths:s}=e,i=[];let l=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(o[l++]);t.push(e)}i.push(t)}return t?n?{rings:i,hasZ:t,hasM:n}:{rings:i,hasZ:t}:n?{rings:i,hasM:n}:{rings:i}}function q(e,t,n=t.hasZ,r=t.hasM){return E(e,t.rings,n,r)}function E(e,t,n,r){const o=p(n,r),{lengths:s,coords:i}=e;let l=0;ae(e);for(const e of t){for(const t of e)for(let e=0;e<o;e++)i[l++]=t[e];s.push(e.length)}return e}const L=[],$=[];function J(e,t,n,r,o){L[0]=e;const[s]=z($,L,t,n,r,o);return ue(L),ue($),s}function z(e,t,n,o,s,i){if(ue(e),!n){for(const n of t){const t=i?n.attributes[i]:void 0;e.push(new u.Om(null,n.attributes,null,t))}return e}switch(n){case"esriGeometryPoint":return function(e,t,n,r,o){const s=O(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?s(new d.A,n):null;e.push(new u.Om(t,r,null,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryMultipoint":return function(e,t,n,r,o){const s=p(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?G(new d.A,n,s):null;e.push(new u.Om(t,r,null,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryPolyline":return function(e,t,n,r,o){const s=p(n,r);for(const{geometry:n,attributes:r,centroid:i}of t){const t=null!=n?k(new d.A,n,s):null,l=null!=i?_(new d.A,i):null;e.push(new u.Om(t,r,l,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryPolygon":return function(e,t,n,r,o){for(const{geometry:s,centroid:i,attributes:l}of t){const t=null!=s?q(new d.A,s,n,r):null,a=o?l[o]:void 0;null!=i?e.push(new u.Om(t,l,S(new d.A,i),a)):e.push(new u.Om(t,l,null,a))}return e}(e,t,o,s,i);default:f().error("convertToFeatureSet:unknown-geometry",new r.A(`Unable to parse unknown geometry type '${n}'`)),ue(e)}return e}function B(e,t,n,r){$[0]=e,Q(L,$,t,n,r);const o=L[0];return ue(L),ue($),o}function U(e,t,n){if(null==e)return null;const o=new d.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),(0,a.fT)(e)?O(null!=t?t:null!=e.z,null!=n?n:null!=e.m)(o,e):(0,a.Bi)(e)?q(o,e,t,n):(0,a.Rg)(e)?k(o,e,p(t,n)):(0,a.U9)(e)?G(o,e,p(t,n)):void f().error("convertFromGeometry:unknown-geometry",new r.A(`Unable to parse unknown geometry type '${e}'`))}function W(e,t,n,o){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=M;return n&&o?e=Z:n?e=j:o&&(e=x),e(s)}case"esriGeometryMultipoint":return C(s,n,o);case"esriGeometryPolyline":return R(s,n,o);case"esriGeometryPolygon":return D(s,n,o);default:return f().error("convertToGeometry:unknown-geometry",new r.A(`Unable to parse unknown geometry type '${t}'`)),null}}function Q(e,t,n,o,s){if(ue(e),null==n)return function(e,t){for(const n of t)e.push({attributes:n.attributes});return e}(e,t);switch(n){case"esriGeometryPoint":return function(e,t,n,r){let o=M;n&&r?o=Z:n?o=j:r&&(o=x);for(const n of t){const{geometry:t,attributes:r}=n,s=null!=t?o(t):null;e.push({attributes:r,geometry:s})}return e}(e,t,o,s);case"esriGeometryMultipoint":return function(e,t,n,r){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?C(o,n,r):null});return e}(e,t,o,s);case"esriGeometryPolyline":return function(e,t,n,r){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?R(o,n,r):null});return e}(e,t,o,s);case"esriGeometryPolygon":return function(e,t,n,r){for(const{geometry:o,attributes:s,centroid:i}of t){const t=null!=o?D(o,n,r):null;if(null!=i){const n=M(i);e.push({attributes:s,centroid:n,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,o,s);default:f().error("convertToFeatureSet:unknown-geometry",new r.A(`Unable to parse unknown geometry type '${n}'`))}return e}function K(e){const{objectIdFieldName:t,spatialReference:n,transform:r,fields:o,hasM:s,hasZ:i,features:l,geometryType:a,exceededTransferLimit:u,uniqueIdField:c,queryGeometry:d,queryGeometryType:p}=e,f={features:Q([],l,a,i,s),fields:o,geometryType:a,objectIdFieldName:t,spatialReference:n,uniqueIdField:c,queryGeometry:W(d,p,!1,!1)};return r&&(f.transform=r),u&&(f.exceededTransferLimit=u),s&&(f.hasM=s),i&&(f.hasZ=i),f}function Y(e,t){const n=new c.A,{hasM:o,hasZ:s,features:i,objectIdFieldName:l,spatialReference:a,geometryType:u,exceededTransferLimit:d,transform:p,fields:h}=e;return h&&(n.fields=h),n.geometryType=u??null,n.objectIdFieldName=l??t??null,n.spatialReference=a??null,n.objectIdFieldName?(i&&z(n.features,i,u,s,o,n.objectIdFieldName),d&&(n.exceededTransferLimit=d),o&&(n.hasM=o),s&&(n.hasZ=s),p&&(n.transform=p),n):(f().error(new r.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)}function V(e){const{transform:t,features:n,hasM:r,hasZ:o}=e;if(!t)return e;for(const e of n)null!=e.geometry&&oe(e.geometry,e.geometry,r,o,t),null!=e.centroid&&oe(e.centroid,e.centroid,r,o,t);return e.transform=null,e}function H(e,t){const{geometryType:n,features:r,hasM:o,hasZ:s}=t;if(!e)return t;for(let t=0;t<r.length;t++){const i=r[t],l=i.weakClone();l.geometry=new d.A,X(l.geometry,i.geometry,o,s,n,e),i.centroid&&(l.centroid=new d.A,X(l.centroid,i.centroid,o,s,"esriGeometryPoint",e)),r[t]=l}return t.transform=e,t}function X(e,t,n,r,o,s,i=n,l=r){if(ae(e),!t?.coords.length)return null;const a=h[o],{coords:u,lengths:c}=t,d=p(n,r),f=p(n&&i,r&&l),y=b(n,r,i,l);if(!c.length)return y(e.coords,u,0,0,I(s,u[0]),F(s,u[1])),ae(e,d,0),e;let m,g,w,v,T=0,M=0,S=M;for(const t of c){if(t<a)continue;let n=0;M=S,w=m=I(s,u[T]),v=g=F(s,u[T+1]),y(e.coords,u,M,T,w,v),n++,T+=d,M+=f;for(let r=1;r<t;r++,T+=d)w=I(s,u[T]),v=F(s,u[T+1]),w===m&&v===g||(y(e.coords,u,M,T,w-m,v-g),M+=f,n++,m=w,g=v);n>=a&&(e.lengths.push(n),S=M)}return ue(e.coords,S),e.coords.length?e:null}function ee(e,t,n,r,o,s,i=n,l=r){if(ae(e),!t?.coords.length)return null;const a=h[o],{coords:u,lengths:c}=t,d=p(n,r),f=p(n&&i,r&&l),y=b(n,r,i,l);if(!c.length)return y(e.coords,u,0,0,u[0],u[1]),ae(e,d,0),e;let m=0;const g=s*s;for(const t of c){if(t<a){m+=t*d;continue}const n=e.coords.length/f,r=m,o=m+(t-1)*d;y(e.coords,u,e.coords.length,r,u[r],u[r+1]),ne(e.coords,u,d,g,y,r,o),y(e.coords,u,e.coords.length,o,u[o],u[o+1]);const s=e.coords.length/f-n;s>=a?e.lengths.push(s):ue(e.coords,n*f),m+=t*d}return e.coords.length?e:null}function te(e,t,n,r){const o=e[t],s=e[t+1],i=e[n],l=e[n+1],a=e[r],u=e[r+1];let c=i,d=l,p=a-c,f=u-d;if(0!==p||0!==f){const e=((o-c)*p+(s-d)*f)/(p*p+f*f);e>1?(c=a,d=u):e>0&&(c+=p*e,d+=f*e)}return p=o-c,f=s-d,p*p+f*f}function ne(e,t,n,r,o,s,i){let l,a=r,u=0;for(let e=s+n;e<i;e+=n)l=te(t,e,s,i),l>a&&(u=e,a=l);a>r&&(u-s>n&&ne(e,t,n,r,o,s,u),o(e,t,e.length,u,t[u],t[u+1]),i-u>n&&ne(e,t,n,r,o,u,i))}function re(e,t,n,r){if(!t?.coords?.length)return null;const o=p(n,r);let s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=o){const n=e[t],r=e[t+1];s=Math.min(s,n),u=Math.max(u,n),a=Math.min(a,r),c=Math.max(c,r)}}return(0,i.is)(e)?(0,i.BI)(e,s,a,u,c):(0,l.fA)(s,a,u,c,e),e}function oe(e,t,n,r,o){const{coords:i,lengths:l}=t,a=p(n,r);if(!i.length)return e!==t&&ae(e),e;(0,s.Lw)(o);const{originPosition:u,scale:c,translate:d}=o,f=ce;f.originPosition=u;const h=f.scale;h[0]=c[0]??1,h[1]=-(c[1]??1),h[2]=c[2]??1,h[3]=c[3]??1;const y=f.translate;if(y[0]=d[0]??0,y[1]=d[1]??0,y[2]=d[2]??0,y[3]=d[3]??0,!l.length){for(let t=0;t<a;++t)e.coords[t]=v(f,i[t],t);return e!==t&&ae(e,a,0),e}let m=0;for(let t=0;t<l.length;t++){const n=l[t];e.lengths[t]=n;for(let t=0;t<a;++t)e.coords[m+t]=v(f,i[m+t],t);let r=e.coords[m],o=e.coords[m+1];m+=a;for(let t=1;t<n;t++,m+=a){r+=i[m]*h[0],o+=i[m+1]*h[1],e.coords[m]=r,e.coords[m+1]=o;for(let t=2;t<a;++t)e.coords[m+t]=v(f,i[m+t],t)}}return e!==t&&ae(e,i.length,l.length),e}function se(e,t,n,r,o,s){if(ae(e),e.lengths.push(...t.lengths),n===o&&r===s)for(let n=0;n<t.coords.length;n++)e.coords.push(t.coords[n]);else{const i=p(n,r),l=b(n,r,o,s),a=t.coords;for(let t=0;t<a.length;t+=i)l(e.coords,a,e.coords.length,t,a[t],a[t+1])}return e}function ie(e,t,n,r){let o=0,s=e[r*t],i=e[r*(t+1)];for(let l=1;l<n;l++){const n=s+e[r*(t+l)],a=i+e[r*(t+l)+1],u=(n-s)*(a+i);s=n,i=a,o+=u}return.5*o}function le(e,t){const{coords:n,lengths:r}=e;let o=0,s=0;for(let e=0;e<r.length;e++){const i=r[e];s+=ie(n,o,i,t),o+=i}return Math.abs(s)}function ae(e,t=0,n=0){ue(e.lengths,n),ue(e.coords,t)}function ue(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},97972:(e,t,n)=>{n.d(t,{BM:()=>M,bd:()=>S,sO:()=>T,xD:()=>c});var r=n(10767),o=n(41509),s=n(57362),i=n(29241),l=n(36511),a=n(44857);const u={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function c(e){return u[e]}function*d(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*p(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function f(e){for(const t of e)if(t.length>2)return!0;return!1}function h(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n],o=e[(n+1)%e.length];t+=r[0]*o[1]-o[0]*r[1]}return t<=0}function y(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function m(e,t,n){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,n){return b(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const r of t.coordinates)b(e,r,n);return e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const r of t.coordinates){g(e,r[0],n);for(let t=1;t<r.length;t++)w(e,r[t],n)}return e}(e,t,n);case"Point":return function(e,t,n){return F(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const r=t.coordinates;g(e,r[0],n);for(let t=1;t<r.length;t++)w(e,r[t],n);return e}(e,t,n)}}function g(e,t,n){const r=y(t);!function(e){return!h(e)}(r)?b(e,r,n):I(e,r,n)}function w(e,t,n){const r=y(t);!function(e){return h(e)}(r)?b(e,r,n):I(e,r,n)}function b(e,t,n){for(const r of t)F(e,r,n);e.lengths.push(t.length)}function I(e,t,n){for(let r=t.length-1;r>=0;r--)F(e,t[r],n);e.lengths.push(t.length)}function F(e,t,n){const[r,o,s]=t;e.coords.push(r,o),n.hasZ&&e.coords.push(s||0)}function v(e){switch(typeof e){case"string":return(0,r.Br)(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function T(e,t=4326){if(!e)throw new o.A("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new o.A("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const r="string"==typeof n?n:"name"===n.type?n.properties.name:"EPSG"===n.type?n.properties.code:null,i=(0,s.oT)({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!r||!i.test(r))throw new o.A("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function M(e,t={}){const n=[],r=new Set,o=new Set;let s,i=!1,l=null,u=!1,{geometryType:h=null}=t,y=!1;for(const t of d(e)){const{geometry:e,properties:d,id:m}=t;if((!e||(h||(h=c(e.type)),c(e.type)===h))&&(i||(i=f(p(e))),u||(u=null!=m,u&&(s=typeof m,d&&(l=Object.keys(d).filter((e=>d[e]===m))))),d&&l&&u&&null!=m&&(l.length>1?l=l.filter((e=>d[e]===m)):1===l.length&&(l=d[l[0]]===m?l:[])),!y&&d)){let e=!0;for(const t in d){if(r.has(t))continue;const s=d[t];if(null==s){e=!1,o.add(t);continue}const i=v(s);if("unknown"===i){o.add(t);continue}o.delete(t),r.add(t);const l=(0,a.rS)(t);l&&n.push({name:l,alias:t,type:i})}y=e}}const m=(0,a.rS)(1===l?.length&&l[0]||null)??void 0;if(m)for(const e of n)if(e.name===m&&(0,a.WA)(e)){e.type="esriFieldTypeOID";break}return{fields:n,geometryType:h,hasZ:i,objectIdFieldName:m,objectIdFieldType:s,unknownFields:Array.from(o)}}function S(e,t){return Array.from(function*(e,t={}){const{geometryType:n,objectIdField:r}=t;for(const o of e){const{geometry:e,properties:s,id:a}=o;if(e&&c(e.type)!==n)continue;const u=s||{};let d;r&&(d=u[r],null==a||d||(u[r]=d=a));const p=new i.Om(e?m(new l.A,e,t):null,u,null,d??void 0);yield p}}(d(e),t))}},38937:(e,t,n)=>{n.d(t,{$1:()=>m,CR:()=>y,MB:()=>p,Yx:()=>a,bP:()=>c});var r=n(10767),o=n(57362),s=n(44857);class i{constructor(){this.code=null,this.description=null}}class l{constructor(e){this.error=new i,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function a(e){return new l(e)}class u{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new u(e)}const d=new Set;function p(e,t,n,r=!1){d.clear();for(const o in n){const i=e.get(o);if(!i)continue;const l=f(i,n[o]);if(d.add(i.name),i&&(r||i.editable)){const e=(0,s.CJ)(i,l);if(e)return a((0,s.uo)(e,i,l));t[i.name]=l}}for(const t of e?.requiredFields??[])if(!d.has(t.name))return a(`missing required field "${t.name}"`);return null}function f(e,t){let n=t;return(0,s.WA)(e)&&"string"==typeof t?n=parseFloat(t):(0,s.yM)(e)&&null!=t&&"string"!=typeof t?n=String(t):(0,s.vE)(e)&&"string"==typeof t&&(n=(0,r._U)(t)),(0,s.WX)(n)}let h;function y(e,t){if(!e||!(0,o.fn)(t))return e;if("rings"in e||"paths"in e){if(null==h)throw new TypeError("geometry engine not loaded");return h.simplify(t,e)}return e}async function m(e,t){!(0,o.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==h&&(h=await Promise.all([n.e(7423),n.e(7322)]).then(n.bind(n,97322))),h}()}},73758:(e,t,n)=>{n.d(t,{GA:()=>P,GL:()=>S,I:()=>O,J0:()=>Z,Ki:()=>x,Px:()=>A,QE:()=>v,bV:()=>j,bW:()=>N,vJ:()=>F}),n(29747);var r=n(18798),o=n(41509),s=n(16431),i=n(76097),l=n(57362),a=n(57974),u=n(96015),c=n(19129),d=n(97972),p=n(32593),f=n(38937),h=n(88681),y=n(18542),m=n(47205),g=n(62771);const w=()=>s.A.getLogger("esri.layers.ogc.ogcFeatureUtils"),b="startindex",I=new Set([b,"offset"]),F="http://www.opengis.net/def/crs/",v=`${F}OGC/1.3/CRS84`;var T,M;async function S(e,t,n={},s=5){const{links:l}=e,a=k(l,"items",T.geojson)||k(l,"http://www.opengis.net/def/rel/ogc/1.0/items",T.geojson);if(null==a)throw new o.A("ogc-feature-layer:missing-items-page","Missing items url");const{apiKey:u,customParameters:c,signal:f}=n,g=(0,i.s2)(a.href,e.landingPage.url),I={limit:s,...c,token:u},F=(0,i.a6)(g,I),v={accept:T.geojson},{data:M}=await(0,r.A)(F,{signal:f,headers:v}),S=D(F,s,M.links)??b;(0,d.sO)(M);const j=(0,d.BM)(M,{geometryType:t.geometryType}),A=t.fields||j.fields||[],x=null!=t.hasZ?t.hasZ:j.hasZ,P=j.geometryType,Z=t.objectIdField||j.objectIdFieldName||"OBJECTID";let N=t.timeInfo;const O=A.find((({name:e})=>e===Z));if(O)O.editable=!1,O.nullable=!1;else{if(!j.objectIdFieldType)throw new o.A("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");A.unshift({name:Z,alias:Z,type:"number"===j.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(Z!==j.objectIdFieldName){const e=A.find((({name:e})=>e===j.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}A===j.fields&&j.unknownFields.length>0&&w().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:j.unknownFields}});for(const e of A){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new o.A("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(!y.m.jsonValues.includes(e.type))throw new o.A("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(N){const e=new h.A(A);if(N.startTimeField){const t=e.get(N.startTimeField);t?(N.startTimeField=t.name,t.type="esriFieldTypeDate"):N.startTimeField=null}if(N.endTimeField){const t=e.get(N.endTimeField);t?(N.endTimeField=t.name,t.type="esriFieldTypeDate"):N.endTimeField=null}if(N.trackIdField){const t=e.get(N.trackIdField);t?N.trackIdField=t.name:(N.trackIdField=null,w().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:N}}))}N.timeReference||={timeZoneIANA:m.n$},N.startTimeField||N.endTimeField||(w().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:N}}),N=void 0)}return{drawingInfo:P?(0,p.F0)(P):null,extent:R(e),geometryType:P,fields:A,hasZ:!!x,objectIdField:Z,paginationParameter:S,timeInfo:N}}async function j(e,t={}){const{links:n,url:s}=e,l=k(n,"data",T.json)||k(n,"http://www.opengis.net/def/rel/ogc/1.0/data",T.json);if(null==l)throw new o.A("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:a,customParameters:u,signal:c}=t,d=(0,i.s2)(l.href,s),{data:p}=await(0,r.A)(d,{signal:c,headers:{accept:T.json},query:{...u,token:a}});for(const t of p.collections)t.landingPage=e;return p}async function A(e,t={}){const{links:n,url:s}=e,l=k(n,"conformance",T.json)||k(n,"http://www.opengis.net/def/rel/ogc/1.0/conformance",T.json);if(null==l)throw new o.A("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:a,customParameters:u,signal:c}=t,d=(0,i.s2)(l.href,s),{data:p}=await(0,r.A)(d,{signal:c,headers:{accept:T.json},query:{...u,token:a}});return p}async function x(e,t={}){const{apiKey:n,customParameters:o,signal:s}=t,{data:i}=await(0,r.A)(e,{signal:s,headers:{accept:T.json},query:{...o,token:n}});return i.url=e,i}async function P(e,t={}){const{links:n,url:o}=e,s=k(n,"service-desc",T.openapi);if(null==s)return w().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:l,customParameters:a,signal:u}=t,c=(0,i.s2)(s.href,o),{data:d}=await(0,r.A)(c,{signal:u,headers:{accept:T.openapi},query:{...a,token:l}});return d}function Z(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),n=t?.groups;if(!n)return null;const{authority:r,code:o}=n;switch(r.toLowerCase()){case"ogc":switch(o.toLowerCase()){case"crs27":return g.A.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return g.A.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(o,10);return Number.isNaN(e)?null:e}default:return null}}async function N(e,t,n){const r=await O(e,t,n);return(0,u.ZF)(r)}async function O(e,t,n){const{collection:{links:s,landingPage:{url:p}},layerDefinition:y,maxRecordCount:m,queryParameters:{apiKey:w,customParameters:b},spatialReference:I,supportedCrs:F}=e,v=k(s,"items",T.geojson)||k(s,"http://www.opengis.net/def/rel/ogc/1.0/items",T.geojson);if(null==v)throw new o.A("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:M,num:S,start:j,timeExtent:A,where:x}=t;if(t.objectIds)throw new o.A("ogc-feature-layer:query-by-objectids-not-supported","Queries with object ids are not supported");const P=g.A.fromJSON(I),Z=t.outSpatialReference??P,N=Z.isWGS84?null:_(Z,F),O=G(M,F),C=function(e){if(null==e)return null;const{start:t,end:n}=e;return`${null!=t?t.toISOString():".."}/${null!=n?n.toISOString():".."}`}(A),R=null!=(Y=x)&&Y&&"1=1"!==Y?Y:null,D=S??(null==j?m:10),q=0===j?void 0:j,{fields:E,geometryType:L,hasZ:$,objectIdField:J,paginationParameter:z}=y,B=(0,i.s2)(v.href,p),{data:U}=await(0,r.A)(B,{...n,query:{...b,...O,crs:N,datetime:C,query:R,limit:D,[z]:q,token:w},headers:{accept:T.geojson}}),W=(0,d.bd)(U,{geometryType:L,hasZ:$,objectIdField:J}),Q=W.length===D&&!!k(U.links??[],"next",T.geojson),K=new h.A(E);var Y;for(const e of W){const t={};(0,f.MB)(K,t,e.attributes),t[J]=e.attributes[J],e.attributes=t}if(!N&&Z.isWebMercator)for(const e of W)if(null!=e.geometry&&null!=L){const t=(0,u.zv)(e.geometry,L,$,!1);t.spatialReference=g.A.WGS84,e.geometry=(0,u.Ux)((0,a.Cv)(t,Z))}for(const e of W)e.objectId=e.attributes[J];const V=N||!N&&Z.isWebMercator?Z.toJSON():l.KK,H=new c.A;return H.exceededTransferLimit=Q,H.features=W,H.fields=E,H.geometryType=L,H.hasZ=$,H.objectIdFieldName=J,H.spatialReference=V,H}function _(e,t){const{isWebMercator:n,wkid:r}=e;if(!r)return null;const o=n?t[3857]??t[102100]??t[102113]??t[900913]:t[e.wkid];return o?`${F}${o}`:null}function C(e){if(null==e)return"";const{xmin:t,ymin:n,xmax:r,ymax:o}=e;return`${t},${n},${r},${o}`}function G(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:n}=e;if(!n||n.isWGS84)return{bbox:C(e)};const r=_(n,t);return null!=r?{bbox:C(e),"bbox-crs":r}:n.isWebMercator?{bbox:C((0,a.Cv)(e,g.A.WGS84))}:null}function R(e){const t=e.extent?.spatial;if(!t)return null;const n=t.bbox[0],r=4===n.length,[o,s]=n,i=r?void 0:n[2];return{xmin:o,ymin:s,xmax:r?n[2]:n[3],ymax:r?n[3]:n[4],zmin:i,zmax:r?void 0:n[5],spatialReference:g.A.WGS84.toJSON()}}function k(e,t,n){return e.find((({rel:e,type:r})=>e===t&&r===n))??e.find((({rel:e,type:n})=>e===t&&!n))}function D(e,t,n){if(!n)return;const r=k(n,"next",T.geojson),o=(0,i.An)(r?.href)?.query;if(!o)return;const s=(0,i.An)(e).query,l=Object.keys(s??{}),a=Object.entries(o).filter((([e])=>!l.includes(e))).find((([e,n])=>I.has(e.toLowerCase())&&Number.parseInt(n,10)===t)),u=a?.[0];return u}(M=T||(T={})).json="application/json",M.geojson="application/geo+json",M.openapi="application/vnd.oai.openapi+json;version=3.0"},45340:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(71566),o=n(89645),s=n(37891),i=n(85464),l=(n(82555),n(16431),n(1724),n(89666)),a=n(37755),u=n(35298),c=n(28981),d=n(99894);let p=class extends((0,o.O)(s.oY)){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const n of Object.keys(e))t[n]=(0,c.rS)(e[n]);return t}writeDomains(e,t){const n={};for(const t of Object.keys(e))e[t]&&(n[t]=e[t]?.toJSON());t.domains=n}};(0,r._)([(0,i.MZ)({json:{write:!0}})],p.prototype,"id",void 0),(0,r._)([(0,i.MZ)({json:{write:!0}})],p.prototype,"name",void 0),(0,r._)([(0,i.MZ)({json:{write:!0}})],p.prototype,"domains",void 0),(0,r._)([(0,l.w)("domains")],p.prototype,"readDomains",null),(0,r._)([(0,u.K)("domains")],p.prototype,"writeDomains",null),(0,r._)([(0,i.MZ)({type:[d.A],json:{write:!0}})],p.prototype,"templates",void 0),p=(0,r._)([(0,a.$)("esri.layers.support.FeatureType")],p);const f=p}}]);