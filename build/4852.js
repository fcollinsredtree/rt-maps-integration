"use strict";(globalThis.webpackChunkredtree_maps_integration=globalThis.webpackChunkredtree_maps_integration||[]).push([[4852],{28605:(e,t,n)=>{n.d(t,{PB:()=>S,d4:()=>A,ZL:()=>N,sZ:()=>D,yC:()=>I,Vr:()=>E});var i=n(71566),r=(n(29747),n(29985)),o=n(41509),s=n(16431),a=n(60764),p=n(97127),l=n(85464),d=(n(82555),n(1724),n(37755)),y=n(81886),u=n(48460),c=n(57362),h=n(96015),m=n(29241),g=n(32191);class f{constructor(){this._featureLookup=new Map}static getInstance(){return f.instance||(f.instance=new f),f.instance}static resetInstance(){f.instance&&(f.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const n=this.readFromStoreById(e);n&&t.push(n)})),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,n){const i=[];return e.forEach((e=>{if(!e?.id)return;e.properties||(e.properties=[]);let r,o=null;if(n&&e.properties[n]&&(o=(0,h.Ux)(e.properties[n])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const i=this._featureLookup.get(e.id),s=JSON.parse(JSON.stringify(Object.assign(i.attributes,e.properties)));n&&e.properties[n]&&(s[n]=(0,g.rS)(e.properties[n])),r=new m.Om(o?JSON.parse(JSON.stringify(o)):i?.geometry?JSON.parse(JSON.stringify(i.geometry)):null,s,null,e.properties[t])}else r=new m.Om(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,r),i.push(r)})),i}}var T=n(91459),w=n(41885),b=n(24721),M=n(9993),_=n(93710);const I="ESRI__ID",E="ESRI__ORIGIN_ID",N="ESRI__DESTINATION_ID",D="ESRI__LAYOUT_GEOMETRY",A="ESRI__AGGREGATION_COUNT";let S=class extends r.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach((n=>{n.name&&(t.set(n.name,"entity"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.knowledgeGraph.dataModel.relationshipTypes?.forEach((n=>{n.name&&(t.set(n.name,"relationship"),this._processingCacheUpdatesLookup.set(n.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(n.name),n.properties?.forEach((e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(n.name,{name:e.name??"",geometryType:e.geometryType})})))})),e.inclusionModeDefinition?.namedTypeDefinitions.forEach(((n,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return s.A.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}const r=new Map;n.members?.forEach((e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(i);const t=this.getById(e.id);t&&r.set(e.id,t)})),this.sublayerCaches.set(i,r)}))}addToLayer(e){e.forEach((({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new o.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const n=this.inclusionModeDefinition.namedTypeDefinitions.get(e);n.members||(n.members=new Map),n.members.set(t,{id:t}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}else{const n=new Map;n.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:n}),(0,a.tE)(this.memberIdTypeLookup,t,(()=>new Set)).add(e)}}))}getById(e){return f.getInstance().readFromStoreById(e)}async getData(e,t,n){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new M.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,n=this._processingCacheUpdatesLookup.get(t.objectType.name??""),r=i.outFields;r&&1===r.length&&r[0]===I&&"1=1"===i.where||await Promise.all(n??[]);const o=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],s=[];return o.forEach((n=>{this.relationshipTypeNames.has(t.objectType.name)?n.geometry=e.relationshipLinkChartDiagramLookup.get(n.attributes[t.objectIdField]):n.geometry=e.entityLinkChartDiagramLookup.get(n.attributes[t.objectIdField]),n.attributes[D]=n.geometry,s.push(n)})),s}return this.retrieveDataFromService(i,t,n)}async getConnectedRecordIds(e,t){const n=[];let i="";const r=[],o=new Map;if(e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(t))return;o.has(t)?o.get(t)?.push(e):o.set(t,[e])}})),t&&0!==t?.length){for(const e of t)i=i+e+"|";i=i.slice(0,-1)}return o.forEach(((e,o)=>{let a;a=t&&0!==t?.length?`MATCH (n:${o})-[r:${i}]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${o})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`;const p=new Promise((t=>{(async()=>{const t=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,new b.A({openCypherQuery:a,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)break;for(let e=0;e<i.length;e++){const t=i[e];n.push({id:t[0],typeName:t[1]}),n.push({id:t[2],typeName:t[3]})}}}catch(e){if("AbortError"!==e.name)throw e;s.A.getLogger(this).info("Request aborted as expected")}})().then((()=>{t()}))}));r.push(p)})),this.refreshCacheContent(),await Promise.all(r),n}async getAttachedRelationships(e,t){const n=[],i=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,new b.A({openCypherQuery:"MATCH (n)-[r]->(m) WHERE id(n) IN $nodeIds AND id(m) in $nodeIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",bindParameters:{nodeIds:e,relationshipExclusionIds:t}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:t}=await i.read();if(e)break;for(let e=0;e<t.length;e++){const i=t[e];n.push({id:i[0],typeName:i[1]})}}}catch(e){if("AbortError"!==e.name)throw e;s.A.getLogger(this).info("Request aborted as expected")}return n}async refreshCacheContent(e,t,n,i=!0){const r=f.getInstance(),s=[],p=new Map,l=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),this.knowledgeGraph.dataModel.relationshipTypes?.forEach((e=>{e.name&&l.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))p.has(t)?p.get(t)?.push(e):p.set(t,[e])})):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach(((e,t)=>{e.useAllData?p.set(t,null):e.members&&e.members.forEach((e=>{p.has(t)&&null!==p.get(t)?p.get(t)?.push(e.id):p.set(t,[e.id])}))})):(this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&p.set(e.name,null)})),this.knowledgeGraph.dataModel.entityTypes?.forEach((e=>{e.name&&p.set(e.name,null)})));for(const[e,d]of p){const p=new Promise((s=>{(async()=>{const s=new Set,p=[];let y,u="",c=!1;if(t||l.get(e)?.properties?.forEach((e=>{e.name&&s.add(e.name)})),n&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&s.add(t)}if(this.entityTypeNames.has(e))u=`MATCH (n:${e}) ${d?"WHERE id(n) IN $ids ":""}return ID(n)`,s.forEach((e=>{u+=`, n.${e}`,p.push(e)}));else{if(!this.relationshipTypeNames.has(e))throw new o.A("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);c=!0,u=`MATCH ()-[n:${e}]->() ${d?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,s.forEach((e=>{u+=`, n.${e}`,p.push(e)}))}y=new b.A(d?{openCypherQuery:u,bindParameters:{ids:d}}:{openCypherQuery:u});const h=(await(0,w.executeQueryStreaming)(this.knowledgeGraph,y)).resultRowsStream.getReader();for(;;){const{done:t,value:n}=await h.read();if(t)break;const o=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,r=0;const s={properties:{}};for(s.id=t[i],i++,r++,c&&(s.originId=t[i],i++,r++,s.destinationId=t[i],i++,r++,(0,a.tE)(this.nodeConnectionsLookup,s.originId,(()=>new Set)).add(s.id),(0,a.tE)(this.nodeConnectionsLookup,s.destinationId,(()=>new Set)).add(s.id),(0,a.tE)(this.relationshipConnectionsLookup,s.id,(()=>[s.originId,s.destinationId])));i<t.length;i++)s.properties[p[i-r]]=t[i];o.push(s)}const s=r.writeToStore(o,I,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const l=this.sublayerCaches.get(e);s.forEach((t=>{l?.set(t.attributes[I],t),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[I])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[I],{id:t.attributes[I]}),(0,a.tE)(this.memberIdTypeLookup,t.attributes[I],(()=>new Set)).add(e))}))}})().then((()=>{s(null)}))}));s.push(p),this._processingCacheUpdatesLookup.get(e)?.push(p)}await Promise.all(s)}removeFromLayer(e){const t=new Set,n=new Set(e.map((e=>e.id)));for(const n of e)t.add(n.typeName),1===this.memberIdTypeLookup.get(n.id)?.size?this.memberIdTypeLookup.delete(n.id):this.memberIdTypeLookup.get(n.id)?.delete(n.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(((e,t)=>{t===n.typeName&&e.members?.has(n.id)&&e.members.delete(n.id)}));t.forEach((e=>{this.sublayerCaches.get(e)?.forEach(((t,i)=>{n.has(i)&&this.sublayerCaches.get(e)?.delete(i)}))}))}async retrieveDataFromService(e,t,n){const i=f.getInstance(),r=new Set,s=[];let a,l="",d=[];const h="relationship"===t.graphType,m=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,g=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let M=!m&&g?Array.from(g).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(M=e.objectIds);else if(null!=e.objectIds&&M&&M.length>0){const t=e.objectIds;e.objectIds=M.filter((e=>t.includes(e)))}else if(null!=e.objectIds)M=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=M}if(null!=e.outFields){const n=e.outFields;n.includes("*")?t.fields.forEach((e=>{r.add(e.name)})):n.forEach((e=>{e!==I&&e!==t.geometryFieldName&&r.add(e)}))}if(null!=e.geometry){const n=e.geometry;let i;const d=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=d?.spatialReference,g=d?.serviceCapabilities?.geometryCapabilities;let f=g?.geometryMaxBoundingRectangleSizeX,w=g?.geometryMaxBoundingRectangleSizeY;if(n?.extent?.spatialReference&&!n.spatialReference?.isWGS84?(await(0,u.initializeProjection)(n.extent.spatialReference,c.KK),i=(0,u.project)(n.extent,c.KK)):i=n.extent,f&&w&&m){if(4326!==m.wkid){const e=new _.A({spatialReference:m,xmax:f,ymax:w}),t=(0,u.project)(e,c.KK);f=t.xmax,w=t.ymax}if(i.xmax-i.xmin>f)throw new o.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${f}° latitude, limit exceeded`);if(i.ymax-i.ymin>w)throw new o.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${w}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const n=await(0,p.G)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&r.add(e.name)}))}l=h?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{l+=`, n.${e}`,s.push(e)})),a=new b.A({openCypherQuery:l,bindParameters:{param_filter_geom:new y.A({rings:(0,T.DX)(i)})}})}else{let n="";if(null!=e.where&&"1=1"!==e.where){const i=await(0,p.G)(e.where,t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&r.add(e.name)}));const o=new Set(["column-reference","string","number","binary-expression"]),s=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&o.has(e.left.type)&&o.has(e.right.type)&&s.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let n=e.right.value;"%"===n.charAt(0)&&(n=n.slice(1)),"%"===n.charAt(n.length-1)&&(n=n.slice(0,-1)),t+=`'${n.toLowerCase()}')`}return t}return a=!0,""};n=l(i.parseTree),a&&(n="")}let i="";i=h?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let o=!1;M&&(o=!0,i+=" WHERE ID(n) IN $ids"),n&&(i+=o?" AND":" WHERE",i+=` ${n}`),i+=" return ID(n)",h&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach((e=>{i+=`, n.${e}`,s.push(e)})),a=new b.A(M?{openCypherQuery:i,bindParameters:{ids:M}}:{openCypherQuery:i})}const E=(await(0,w.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,n)).resultRowsStream.getReader();for(;;){const{done:e,value:n}=await E.read();if(e)break;const r=[];for(let e=0;e<n.length;e++){const t=n[e];let i=0,o=0;const a={properties:{}};for(a.id=t[i],i++,o++,h&&(a.originId=t[i],i++,o++,a.destinationId=t[i],i++,o++);i<t.length;i++)a.properties[s[i-o]]=t[i];r.push(a)}d=d.concat(i.writeToStore(r,I,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return d}};(0,i._)([(0,l.MZ)()],S.prototype,"knowledgeGraph",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"inclusionModeDefinition",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"entityTypeNames",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"relationshipTypeNames",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"geographicLookup",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"sublayerCaches",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"nodeConnectionsLookup",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"relationshipConnectionsLookup",void 0),(0,i._)([(0,l.MZ)()],S.prototype,"memberIdTypeLookup",void 0),S=(0,i._)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],S)},40726:(e,t,n)=>{n.d(t,{A:()=>H});var i=n(71566),r=(n(29747),n(14717)),o=(n(5971),n(68797),n(98172),n(86788),n(55831),n(76673),n(55983),n(2885),n(97779)),s=n(68261),a=n(80327),p=n(87216),l=(n(12708),n(85464)),d=(n(82555),n(16431),n(37755)),y=n(35298),u=n(28523),c=n(48460),h=n(62771),m=n(57362),g=n(88999),f=n(22560),T=n(67395),w=n(32593),b=n(28605);n(1724);const M=(0,n(7683).p)(),_=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i._)([(0,l.MZ)(M.fields)],t.prototype,"fields",void 0),(0,i._)([(0,l.MZ)(M.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,i._)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var I=n(18453),E=n(36521),N=n(52481),D=n(46403),A=n(22019),S=n(98265),v=n(80358),L=n(38420),R=n(31504),k=n(30086),j=n(44857),x=n(65922),C=n(8238),O=n(40546),q=n(9993),Z=n(99544),G=n(60029),F=n(93710),$=n(81886),Q=n(35922),P=n(77069);function J(e){if(!e.json)return e;e.json.write=U(e.json.write);const t=e.json.origins;if(!t)return e;let n;for(n in t){const e=t[n];e&&(e.write=U(e.write))}return e}function U(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:n,overridePolicy:i,...r}=e;return function(e,t){const n=Y.call(this,e,t);return n.enabled?{...r,...n}:n}}(e)),e):!0===e?B():e}function B(){return{overridePolicy:Y}}function Y(e,t){const n=!!this.geometryType;let i={enabled:n};return n&&(i={...i,...V.call(this,e,t)}),i}function V(e,t){return{ignoreOrigin:this.originIdOf(t)>u.Gr.DEFAULTS}}let K=class extends(_((0,N.J)((0,E.F)((0,I.dM)((0,D.f)((0,v.e)((0,S.j)((0,A.J)((0,p.P)(g.A)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,w.f)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=b.yC,this.objectType=null,this.opacity=1,this.orderBy=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new G.A(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const n=q.A.fromJSON(e);return this.queryFeaturesJSON(n,t)}}}),[e.port2]}))},this.title=null,this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach((t=>{const n="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(k.A.fromJSON({name:t.name,type:n,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))})),e.push(k.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),k.A.fromJSON({name:b.d4,type:"esriFieldTypeInteger",alias:b.d4,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?P.g.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return b.sZ;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,n=t?this.objectType?.properties?.[t]:null;return n?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,n=t?this.objectType?.properties?.[t]:null;return n?.hasZ??!1}set renderer(e){(0,j.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){return this._isOverridden("renderer")?this._get("renderer"):"link-chart"===this.parentCompositeLayer?.type?"relationship"===this.graphType?(0,o.r)((0,w.F0)(P.g.toJSON("polyline")).renderer):(0,o.r)((0,w.F0)(P.g.toJSON("point")).renderer):(0,o.r)((0,w.F0)(P.g.toJSON(this.geometryType)).renderer)}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??h.A.WGS84}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,Z.tn)(this,e)}createQuery(){return new q.A({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];return null}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e),r=O.A.fromJSON(await i.executeQuery(n.toJSON(),t?.signal));return r.features.forEach((e=>{e.sourceLayer=this})),r}async queryFeaturesJSON(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(n.toJSON(),t?.signal)}async queryFeatureCount(e,t){const{resolvedQuery:n,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(n.toJSON(),t?.signal)}async queryExtent(e={},t){const n={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:r}=await this._setupQueryObjects(n),o=await r.executeQueryForExtent(i.toJSON(),t?.signal);let s;return s=null!=o.extent?.xmin&&null!=o.extent?.xmax&&null!=o.extent?.ymin&&null!=o.extent?.ymax?new F.A(o.extent):new F.A,{count:o.count,extent:s}}async queryObjectIds(e,t){const n=q.A.from(e);let i;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);i=this.loadQueryEngine(e)}return i.executeQueryForIds(n.toJSON(),t?.signal)}loadQueryEngine(e){const t=new f.A({geometryType:P.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new T.d({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:P.g.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return n.featureStore.addMany(e),n}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new q.A({where:"1=1",outFields:[b.yC]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){const n=q.A.from(e),i=n.geometry;let r;if(i&&!i.spatialReference?.isWGS84&&(await(0,c.initializeProjection)(i.spatialReference,m.KK),n.geometry=(0,c.project)(i instanceof $.A||i instanceof Q.A?i:i.extent,m.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:n,queryEngine:r}}};(0,i._)([(0,l.MZ)(J((0,a.o8)(I.sU)))],K.prototype,"blendMode",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"capabilities",void 0),(0,i._)([(0,l.MZ)({json:{origins:{"web-scene":{write:!1}},write:B()}})],K.prototype,"charts",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],K.prototype,"defaultPopupTemplate",null),(0,i._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],K.prototype,"definitionExpression",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"displayField",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(I.LF)))],K.prototype,"effect",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"elevationInfo",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(E.Y)))],K.prototype,"featureEffect",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(R.d)))],K.prototype,"featureReduction",null),(0,i._)([(0,l.MZ)()],K.prototype,"fields",null),(0,i._)([(0,l.MZ)()],K.prototype,"geometryType",null),(0,i._)([(0,l.MZ)()],K.prototype,"geometryFieldName",null),(0,i._)([(0,l.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],K.prototype,"graphType",void 0),(0,i._)([(0,l.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],K.prototype,"graphTypeName",null),(0,i._)([(0,l.MZ)()],K.prototype,"hasM",null),(0,i._)([(0,l.MZ)()],K.prototype,"hasZ",null),(0,i._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],K.prototype,"id",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.kF)))],K.prototype,"labelsVisible",void 0),(0,i._)([(0,l.MZ)({type:[x.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:C.w,write:B()}})],K.prototype,"labelingInfo",void 0),(0,i._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],K.prototype,"layerType",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.fV)))],K.prototype,"legendEnabled",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.hG)))],K.prototype,"maxScale",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.hn)))],K.prototype,"minScale",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"objectIdField",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"objectType",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.ke)))],K.prototype,"opacity",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(D.n)))],K.prototype,"orderBy",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"parentCompositeLayer",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(L.M6)))],K.prototype,"popupEnabled",void 0),(0,i._)([(0,l.MZ)({type:r.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],K.prototype,"popupTemplate",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy:V}}})],K.prototype,"refreshInterval",void 0),(0,i._)([(0,l.MZ)({types:s.H,json:{name:"layerDefinition.drawingInfo.renderer",write:B()}})],K.prototype,"renderer",null),(0,i._)([(0,l.MZ)()],K.prototype,"source",void 0),(0,i._)([(0,l.MZ)()],K.prototype,"spatialReference",null),(0,i._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],K.prototype,"title",void 0),(0,i._)([(0,y.K)("title")],K.prototype,"writeTitle",null),(0,i._)([(0,l.MZ)({json:{read:!1}})],K.prototype,"type",void 0),(0,i._)([(0,l.MZ)(J((0,a.o8)(v.B)))],K.prototype,"useViewTime",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{name:"visibility",write:B()}})],K.prototype,"visible",void 0),K=(0,i._)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],K);const H=K},91459:(e,t,n)=>{n.d(t,{DX:()=>T,_s:()=>b,aq:()=>w,fe:()=>M});var i,r,o,s,a=n(18798),p=n(41509),l=n(60764),d=(n(96015),n(41885)),y=n(24721);n(29747),n(62771),(r=i||(i={})).ELEMENTUID="ELEMENTUID",r.TYPENAME="TYPENAME",i.ELEMENTUID,i.TYPENAME,function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(o||(o={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(s||(s={}));var u,c,h,m,g,f=n(77165);function T(e){if(!e.spatialReference.isWGS84)throw new p.A("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}async function w(e,t){const n=[],i=new Map,r=[];if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&i.set(e.name,[]);for(const t of e)i.has(t.typeName)&&i.get(t.typeName)?.push(t.id);for(const[e,o]of i){if(o.length<1)continue;const i=new y.A({openCypherQuery:`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:o}});r.push((0,d.executeQueryStreaming)(t,i).then((async e=>{const t=e.resultRowsStream.getReader();for(;;){const{done:e,value:i}=await t.read();if(e)break;for(const e of i)n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}})))}return await Promise.all(r),n}async function b(e,t){t??=!1;const n={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,a.A)(e,{responseType:"array-buffer"}),n=await t.data;return async function(e){const t=new((await(0,f.I)()).MapOfObjectIdentifierSetsDecoder),n=t.decode(new Uint8Array(e)),i=new Map;if(0!==n.error_code)throw new p.A("knowledge-graph:layer-support-utils",n.error_message);const r=t.get_map_of_identifier_sets(),o=r.keys,s=o.size();for(let e=0;e<s;e++){const t=o.get(e),n=r.query_identifier_set(t),s=[];if(n.id_array_type.value===m.GLOBALID_ARRAY){const e=n.get_globalid_array(),t=e.count();for(let n=0;n<t;n++)s.push(e.get_globalid_at(n))}else{if(n.id_array_type.value!==m.IDENTIFIER_ARRAY)throw new p.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=n.get_identifier_array(),t=e.count();for(let n=0;n<t;n++)s.push(e.get_identifier_at(n).toString())}}i.set(t,s)}return t.delete(),i}(new Uint8Array(n))}(e).then((e=>{!function(e,t){for(const[n,i]of e){const e=(0,l.tE)(t.namedTypeDefinitions,n,(()=>({useAllData:!1,members:new Map})));for(const t of i)e.members.has(t)||e.members.set(t,{id:t})}}(e,n)})),n}async function M(e){const t=await(0,f.I)(),n=new t.MapOfObjectIdentifierSets;!function(e,t,n){for(const[i,r]of n.namedTypeDefinitions){if(!r.members||r.useAllData)continue;const n=r.members.keys(),o=new t.GlobalIdArray,s=new t.ObjectIdentifierSet;for(const e of n)o.add_globalid(e);s.set_globalid_array(o),o.delete(),e.put_identifier_set(i,s),s.delete()}}(n,t,e);const i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(n),i.encode();const e=i.get_encoding_result();if(0!==e.error.error_code)throw new p.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return i.delete(),t}finally{n.delete()}}n(8759),(g=u||(u={}))[g.featureResult=0]="featureResult",g[g.countResult=1]="countResult",g[g.idsResult=2]="idsResult",function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(c||(c={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(h||(h={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(m||(m={}))},64392:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(71566),r=(n(29747),n(85464)),o=(n(82555),n(16431),n(1724),n(37755)),s=n(85233),a=n(54790);let p=class extends s.A{constructor(e){super(e),this.layoutGeometry=null}};(0,i._)([(0,r.MZ)({type:a.A,json:{write:!0}})],p.prototype,"layoutGeometry",void 0),p=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.Entity")],p);const l=p},85233:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(71566),r=n(85464),o=(n(82555),n(16431),n(1724),n(37755)),s=n(53464);let a=class extends s.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a);const p=a},53464:(e,t,n)=>{n.d(t,{A:()=>p});var i=n(71566),r=n(37891),o=n(85464),s=(n(82555),n(16431),n(1724),n(37755));let a=class extends r.oY{constructor(e){super(e),this.properties=null}};(0,i._)([(0,o.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.GraphObject")],a);const p=a},24721:(e,t,n)=>{n.d(t,{A:()=>d});var i=n(71566),r=n(85464),o=(n(82555),n(16431),n(1724),n(37755)),s=n(29985);let a=class extends s.A{constructor(e){super(e),this.openCypherQuery=""}};(0,i._)([(0,r.MZ)()],a.prototype,"openCypherQuery",void 0),a=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQuery")],a);const p=a;let l=class extends p{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,i._)([(0,r.MZ)()],l.prototype,"bindParameters",void 0),(0,i._)([(0,r.MZ)()],l.prototype,"bindGeometryQuantizationParameters",void 0),(0,i._)([(0,r.MZ)()],l.prototype,"outputQuantizationParameters",void 0),(0,i._)([(0,r.MZ)()],l.prototype,"outputSpatialReference",void 0),(0,i._)([(0,r.MZ)()],l.prototype,"provenanceBehavior",void 0),l=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],l);const d=l},51947:(e,t,n)=>{n.d(t,{A:()=>a});var i=n(71566),r=(n(16431),n(82555),n(1724),n(41509),n(37755)),o=n(53464);let s=class extends o.A{constructor(e){super(e)}};s=(0,i._)([(0,r.$)("esri.rest.knowledgeGraph.ObjectValue")],s);const a=s},35988:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(71566),r=n(37891),o=n(85464),s=(n(82555),n(16431),n(1724),n(37755)),a=n(53464);let p=class extends r.oY{constructor(e){super(e),this.path=null}};(0,i._)([(0,o.MZ)({type:[a.A],json:{write:!0}})],p.prototype,"path",void 0),p=(0,i._)([(0,s.$)("esri.rest.knowledgeGraph.Path")],p);const l=p},24521:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(71566),r=(n(29747),n(85464)),o=(n(82555),n(16431),n(1724),n(37755)),s=n(85233),a=n(35922);let p=class extends s.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],p.prototype,"originId",void 0),(0,i._)([(0,r.MZ)({type:String,json:{write:!0}})],p.prototype,"destinationId",void 0),(0,i._)([(0,r.MZ)({type:a.A,json:{write:!0}})],p.prototype,"layoutGeometry",void 0),p=(0,i._)([(0,o.$)("esri.rest.knowledgeGraph.Relationship")],p);const l=p}}]);